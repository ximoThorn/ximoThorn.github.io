<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.66">
<title data-react-helmet="true">Posts tagged &quot;react&quot; | ihooks</title><meta data-react-helmet="true" property="og:title" content="Posts tagged &quot;react&quot; | ihooks"><meta data-react-helmet="true" name="description" content="Blog | Tagged &quot;react&quot;"><meta data-react-helmet="true" property="og:description" content="Blog | Tagged &quot;react&quot;"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/styles.21003791.css">
<link rel="preload" href="/styles.39f5ff0b.js" as="script">
<link rel="preload" href="/runtime~main.f2293dd5.js" as="script">
<link rel="preload" href="/main.a113fba2.js" as="script">
<link rel="preload" href="/common.ae509e21.js" as="script">
<link rel="preload" href="/2.f850d953.js" as="script">
<link rel="preload" href="/4.a2813fba.js" as="script">
<link rel="preload" href="/6875c492.698807e2.js" as="script">
<link rel="preload" href="/271584f9.bf5a1dc2.js" as="script">
<link rel="preload" href="/d1e50573.d85aa13d.js" as="script">
<link rel="preload" href="/986f7180.303407a1.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">ihooks</strong></a><a class="navbar__item navbar__link" href="/docs/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://doranui.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">doranUI</a><a href="https://github.com/ximoThorn/ihooks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">ihooks</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://doranui.github.io" target="_blank" rel="noopener noreferrer" class="menu__link">doranUI</a></li><li class="menu__list-item"><a href="https://github.com/ximoThorn/ihooks" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_GFRE"><h3 class="sidebarItemTitle_3473">Recent posts</h3><ul class="sidebarItemList_117a"><li class="sidebarItem_2Wrv"><a class="sidebarItemLink_ZFZd" href="/blog/lerna">lerna</a></li><li class="sidebarItem_2Wrv"><a class="sidebarItemLink_ZFZd" href="/blog/å‰ç«¯ç›‘æ§">å‰ç«¯ç›‘æ§</a></li><li class="sidebarItem_2Wrv"><a class="sidebarItemLink_ZFZd" href="/blog/react fiber">react fiber</a></li><li class="sidebarItem_2Wrv"><a class="sidebarItemLink_ZFZd" href="/blog/æµè§ˆå™¨çš„æ¸²æŸ“æœºåˆ¶">æµè§ˆå™¨çš„æ¸²æŸ“æœºåˆ¶</a></li></ul></div></div><main class="col col--8"><h1>1 post tagged with &quot;react&quot;</h1><a href="/blog/tags">View All Tags</a><div class="margin-vert--xl"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_2QPY"><a href="/blog/react fiber">react fiber</a></h2><div class="margin-vert--md"><time datetime="2021-01-30T00:00:00.000Z" class="blogPostDate_2nK8">January 30, 2021  Â· 2 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/ximoThorn" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/32925631?s=60&amp;v=4"></a><div class="avatar__intro"></div></div></header><section class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="react-fiber"></a>react fiber<a aria-hidden="true" tabindex="-1" class="hash-link" href="#react-fiber" title="Direct link to heading">#</a></h1><p>åœ¨v15å’Œä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œåœ¨reactä»»æ„ä¸€ä¸ªåœ°æ–¹æ‰§è¡ŒsetStateåï¼Œreactä¼šå¯¹æ•´ä¸ªé¡µé¢åˆ›å»ºè™šæ‹Ÿdomï¼Œå¹¶å¯¹å‰ådomè¿›è¡Œdiffå¯¹æ¯”ï¼Œç„¶åè¿›è¡Œæ¸²æŸ“ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯â€œä¸€æ°”å‘µæˆâ€çš„ï¼Œæ‰€ä»¥å®ƒå æ®äº†ä¸»çº¿ç¨‹çš„å¤§é‡æ—¶é—´ï¼Œè¿™ä¼šä½¿é¡µé¢å“åº”åº¦å˜å·®ï¼Œä¹Ÿå°±å¯¼è‡´äº†reactåœ¨æ¸²æŸ“åŠ¨ç”»ï¼Œæˆ–è€…æ‰‹åŠ¿æ“ä½œæ—¶ä¼šå‡ºç°å¡é¡¿ç°è±¡ï¼Œå› æ­¤reactå›¢é˜Ÿåœ¨reactçš„v16ç‰ˆæœ¬åé‡‡ç”¨äº†fiberæ¶æ„ã€‚</p><p>ç†Ÿæ‚‰fiberä¹‹å‰éœ€è¦å…ˆäº†è§£å‡ ä¸ªåŸºç¡€çŸ¥è¯†ï¼š<strong>window.requestIdleCallback</strong>ï¼Œ<strong>å•é“¾è¡¨</strong>
<img src="https://user-images.githubusercontent.com/32925631/90331506-89c43c80-dfe7-11ea-9f1a-1934ed6a013f.png" alt="image"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="å¸§ç‡"></a>å¸§ç‡<a aria-hidden="true" tabindex="-1" class="hash-link" href="#å¸§ç‡" title="Direct link to heading">#</a></h2><p>æˆ‘ä»¬çŸ¥é“å±å¹•æµè§ˆå™¨åˆ·æ–°ç‡60å¸§/sï¼Œå¹³å‡16.6ms/å¸§ï¼Œåœ¨ä¸€å¸§ä¸­æµè§ˆå™¨åšäº†å¾ˆå¤šäº‹æƒ…ï¼š</p><p>åœ¨æµè§ˆå™¨æ‰§è¡Œä¸€å¸§çš„è¿‡ç¨‹ä¸­ï¼š</p><ol><li><p>Input event handlersï¼šåˆæˆçº¿ç¨‹ compositor thread æŠŠ input æ•°æ®ä¼ ç»™ä¸»çº¿ç¨‹ï¼Œ å¤„ç†äº‹ä»¶å›è°ƒã€‚</p></li><li><p>javascript: åŒ…æ‰©å®šæ—¶å™¨ã€äº‹ä»¶ï¼ˆscrollï¼Œresizeç­‰ï¼‰ã€requestAnimationFrameã€é‡æ’ï¼ˆlayoutï¼‰ã€é‡ç»˜ï¼ˆpaintï¼‰</p></li><li><p>å¦‚æœåœ¨ä¸€å¸§å†…ï¼Œæ‰§è¡Œå®Œä¸Šè¿°æ‰€æœ‰ä»»åŠ¡åï¼Œè¿˜æœ‰å‰©ä½™æ—¶é—´çš„è¯ï¼Œé‚£å°±ä¼šæ‰§è¡ŒrequestIdleCallbackå›è°ƒï¼Œ</p></li></ol><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-js codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token dom variable" style="color:rgb(191, 199, 213)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">requestIdleCallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// callback(deadline): ä¸€ä¸ªfunction ç”¨æˆ·è¦æ‰§è¡Œçš„å›è°ƒä»»åŠ¡, å¹¶ä¼ å…¥ä¸€ä¸ªå‚æ•°deadline</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//  deadline: {</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//  timeRemaining: 0ms, // å½“å‰å¸§è¿˜å‰©ä½™å¤šå°‘æ—¶é—´</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//  didTimeout: false, // æ˜¯å¦å·²è¶…æ—¶</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//  }</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// options: // ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥è®¾ç½®timeoutæ—¶é—´ï¼šè¶…è¿‡è¿™ä¸ªæ—¶é—´åï¼Œä¸ç®¡å½“å‰æ˜¯å¦æœ‰å‰©ä½™æ—¶é—´å¿…é¡»æ‰§è¡Œæ­¤å›è°ƒ</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><blockquote><p>å› ä¸ºrequestIdleCallbackå…¼å®¹æ€§å·®ï¼Œæ‰€ä»¥reactå†…éƒ¨å¹¶ä¸æ˜¯ç›´æ¥ç”¨è¿™ä¸ªapiï¼Œè€Œæ˜¯è‡ªå·±å®ç°äº†è¿™ä¸ªapiï¼Œç†è®ºæ•ˆæœæ˜¯ä¸€æ ·çš„</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="å•é“¾è¡¨"></a>å•é“¾è¡¨<a aria-hidden="true" tabindex="-1" class="hash-link" href="#å•é“¾è¡¨" title="Direct link to heading">#</a></h2><p>åœ¨fiberä¸­æœ‰å¤§é‡çš„å•é“¾è¡¨ï¼Œç”¨ä¸€å¼ å›¾è¡¨ç¤ºï¼š</p><p><img src="https://user-images.githubusercontent.com/32925631/90331514-a19bc080-dfe7-11ea-9c2e-c30f3689455b.png" alt="image"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="é‡å›fiber"></a>é‡å›fiber<a aria-hidden="true" tabindex="-1" class="hash-link" href="#é‡å›fiber" title="Direct link to heading">#</a></h2><p><strong>1.é€šè¿‡fiberåˆç†åˆ†é…cpuèµ„æºï¼Œæé«˜ç”¨æˆ·ç›¸åº”é€Ÿåº¦ï¼›2.é€šè¿‡fiberå¯ä»¥ä½¿reconciliationï¼ˆä¸€ç§diffç®—æ³•ï¼‰å¯ä»¥ä¸­æ–­ï¼Œäº¤å‡ºä¸»çº¿ç¨‹ï¼Œå»æ‰§è¡Œæ›´é‡è¦çš„äº‹æƒ…ï¼ˆæ¸²æŸ“ï¼Œäº¤äº’ç­‰ï¼‰</strong></p><p>é‚£ä¹ˆfiberæ˜¯ä»€ä¹ˆï¼šfiberæ˜¯ä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç»“æ„</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="æ‰§è¡Œå•å…ƒfiber"></a>æ‰§è¡Œå•å…ƒfiber<a aria-hidden="true" tabindex="-1" class="hash-link" href="#æ‰§è¡Œå•å…ƒfiber" title="Direct link to heading">#</a></h3><p>æ¯æ¬¡æµè§ˆå™¨æ‰§è¡Œå®Œä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œreactå°±ä¼šæ£€æŸ¥æ—¶å€™è¿˜æœ‰å‰©ä½™æ—¶é—´ï¼ˆæ¯ä¸€å¸§éƒ½ä¼šå»æ£€æŸ¥ï¼‰ï¼Œå¦‚æœæ²¡æœ‰ï¼Œreactå°±æ”¾æƒç»™æµè§ˆå™¨</p><p><img src="https://user-images.githubusercontent.com/32925631/90331527-bf692580-dfe7-11ea-8719-2d1066ba8be0.png" alt="image"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="æ•°æ®æœºæ„fiber"></a>æ•°æ®æœºæ„fiber<a aria-hidden="true" tabindex="-1" class="hash-link" href="#æ•°æ®æœºæ„fiber" title="Direct link to heading">#</a></h3><p>reactä½¿ç”¨é“¾è¡¨ï¼Œå°†æ¯ä¸€ä¸ªVirtualDomèŠ‚ç‚¹åŠå…¶å†…éƒ¨æ‰€æœ‰å­ï¼ˆä¸æ˜¯å­™å­ï¼‰èŠ‚ç‚¹è¡¨ç¤ºä¸ºä¸€ä¸ªfiberã€‚å¦‚å›¾ï¼š
<img src="https://user-images.githubusercontent.com/32925631/90331536-d14ac880-dfe7-11ea-9a24-f39fd629fd6f.png" alt="image"></p><p>å…¶ä¸­A1&gt;B1+B2å°±æ˜¯ä¸€ä¸ªfiberï¼ŒB1&gt;C1+C2æ˜¯ä¸€ä¸ªfiber</p><p>æ¯ä¸ªfiberå…¶å®å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé™¤äº†ä¸€äº›å±æ€§è¿˜åŒ…æ‹¬ä¸‰ä¸ªæŒ‡é’ˆ</p><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-js codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> fiber </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//å½“å‰èŠ‚ç‚¹ç±»å‹ï¼Œæ–‡æœ¬è¿˜æ˜¯dom</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ROOT&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å”¯ä¸€æ ‡è¯†</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å½“å‰å…ƒç´ ç±»å‹ï¼Œspanã€div</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  stateNode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// fiberå¯¹åº”çš„nodeèŠ‚ç‚¹</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  flag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// placementç­‰ï¼Œå‰¯ä½œç”¨ç±»å‹ï¼Œä¾‹å¦‚ï¼š å¢åˆ æ”¹æŸ¥</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  firstEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token keyword null nil" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  lastEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token keyword null nil" style="font-style:italic">null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ä¸‰ä¸ªæŒ‡é’ˆ</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  child</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æŒ‡å‘å½“å‰ç¬¬ä¸€ä¸ªå­fiber</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sibling</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æŒ‡å‘å½“å‰ç´§æŒ¨ç€çš„å…„å¼Ÿfiber</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æŒ‡å‘å½“å‰çš„çˆ¶fiber</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="reactçš„æ„å»ºè¿‡ç¨‹"></a>reactçš„æ„å»ºè¿‡ç¨‹<a aria-hidden="true" tabindex="-1" class="hash-link" href="#reactçš„æ„å»ºè¿‡ç¨‹" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-js codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æµè§ˆå™¨ç©ºé—²æ—¶é—´æ‰§è¡Œ</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">requestIdleCallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workLoop</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//reactä¸­æ˜¯é€šè¿‡requestAnimationFrameå’ŒMessageChannelå®ç°çš„</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> rootFiber </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> workInProgress </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> rootFiber </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//å½“å‰æ­£åœ¨æ‰§è¡Œçš„å·¥ä½œå•å…ƒï¼ˆfiberï¼‰</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">workLoop</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">deadLine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// deadLineæ¯å¸§å‰©ä½™æ—¶é—´å¯¹è±¡</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> deadLine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">timeRemaining</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      workInProgress </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">performUnitOfWork</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ¯ä¸ªä»»åŠ¡å•å…ƒæ‰§è¡Œå®Œæ¯•åè¿”å›ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„ä»»åŠ¡å•å…ƒ</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æäº¤é˜¶æ®µ</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">commitRoot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rootFiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">performUnitOfWork</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">beginWork</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// åˆ›å»ºå­fiberæ ‘</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">child</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">child</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ä¼˜å…ˆæ„å»ºchild</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token function" style="color:rgb(130, 170, 255)">completeUnitWork</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å½“å‰å·¥ä½œå•å…ƒå®Œæˆæ„å»ºï¼Œå¹¶ç”Ÿæˆdom</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">sibling</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">sibling</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ²¡æœ‰childï¼Œæ„å»ºsibling</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      workInProgress </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">return</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æœ€åæ²¡æœ‰çˆ¶å…ƒç´ ï¼ˆrootï¼‰é€€å‡ºå¾ªç¯</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å¼€å§‹åˆ›å»ºå­Fiberæ ‘ğŸŒ²</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">beginWork</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> nextChildren </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">children</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">reconcileChildren</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> nextChildren</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">reconcileChildren</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">returnFiber</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> nextChildren</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ ¹æ®VDomç”Ÿæˆfiberçš„åŒæ—¶å¹¶æ„å»ºfiberé“¾(å°±æ˜¯ç»™fiberçš„childï¼Œsibline, returnå±æ€§èµ‹å€¼)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> nextChildren</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> newFiber </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createFiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">nextChildren</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// åˆ›å»ºfiber</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createFiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">element</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">TAG_HOST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> element</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      props</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> element</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> element</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">completeUnitWork</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">switch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">TAG_HOST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">createStateNode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ ¹æ®fiberç”ŸæˆçœŸå®domèŠ‚ç‚¹</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å®Œæˆæ—¶åˆ¤æ–­æœ‰æ²¡æœ‰å¯¹åº”çš„domæ“ä½œï¼Œæœ‰çš„è¯æ·»åŠ åˆ°å‰¯ä½œç”¨é“¾è¡¨ä¸­</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">makeEffectList</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">makeEffectList</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ ¹æ®æ¯ä¸ªfiberçš„firstEffectå’ŒlastEffectä»¥åŠflags</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å½’å¹¶fiberæ ‘ä¸­å„fiberçš„å‰¯ä½œç”¨ï¼Œå½¢æˆå‰¯ä½œç”¨é“¾</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// firstEffect -&gt; nextEffect -&gt; ... -&gt; lastEffect</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">commitRoot</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">rootFiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> currentEffect </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> rootFiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">firstEffect</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">currentEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">switch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">currentEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">flags</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å‰¯ä½œç”¨ç±»å‹</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token maybe-class-name">Placement</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">commitPlacemen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">currentEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å‘çˆ¶domæ·»åŠ å­dom</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      currentEffect </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> currentEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">nextEffect</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">commitPlacemen</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">currentEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> parent </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> currentEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">return</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">stateNode</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    parent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">appendChild</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">currentEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">stateNode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="æ€»ç»“"></a>æ€»ç»“<a aria-hidden="true" tabindex="-1" class="hash-link" href="#æ€»ç»“" title="Direct link to heading">#</a></h2><p>reactå°†jsxç»è¿‡createElementå¤„ç†å½¢æˆè™šæ‹ŸdomèŠ‚ç‚¹åçš„è¿›è¡Œæ¸²æŸ“ï¼Œä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š
diffé˜¶æ®µå’Œcommité˜¶æ®µï¼š
åœ¨diffé˜¶æ®µè¿›è¡Œæ–°æ—§è™šæ‹Ÿdomå¯¹æ¯”ï¼Œè¿›è¡Œæ›´æ–°ï¼Œå¢é‡æˆ–è€…åˆ é™¤ï¼Œå¹¶ä¸”æ ¹æ®è™šæ‹Ÿdomç”Ÿæˆfiberæ ‘</p><blockquote><p>diffé˜¶æ®µå¯ä»¥æš‚åœï¼Œå› ä¸ºdiffé˜¶æ®µæ¯”è¾ƒèŠ±æ—¶é—´ï¼Œreactä¼šå¯¹ä»»åŠ¡è¿›è¡Œæ‹†åˆ†</p></blockquote><p>commité˜¶æ®µè¿›è¡ŒDOMçš„æ›´æ–°åˆ›å»ºï¼Œæ­¤é˜¶æ®µä¸èƒ½æš‚åœï¼Œéœ€è¦â€œä¸€æ°”å‘µæˆâ€</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/react">react</a><a class="margin-horiz--sm" href="/blog/tags/javascript">javascript</a></div><div class="col text--right"><a aria-label="Read more about react fiber" href="/blog/react fiber"><strong>Read More</strong></a></div></footer></article></div></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/doc2/">Second Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/ximoThorn/ihooks" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://doranui.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">doranUI</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2022 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.39f5ff0b.js"></script>
<script src="/runtime~main.f2293dd5.js"></script>
<script src="/main.a113fba2.js"></script>
<script src="/common.ae509e21.js"></script>
<script src="/2.f850d953.js"></script>
<script src="/4.a2813fba.js"></script>
<script src="/6875c492.698807e2.js"></script>
<script src="/271584f9.bf5a1dc2.js"></script>
<script src="/d1e50573.d85aa13d.js"></script>
<script src="/986f7180.303407a1.js"></script>
</body>
</html>