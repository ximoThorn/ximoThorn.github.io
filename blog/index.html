<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.66">
<title data-react-helmet="true">Blog | ihooks</title><meta data-react-helmet="true" property="og:title" content="Blog | ihooks"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/styles.21003791.css">
<link rel="preload" href="/styles.434451da.js" as="script">
<link rel="preload" href="/runtime~main.5370db81.js" as="script">
<link rel="preload" href="/main.05977f1d.js" as="script">
<link rel="preload" href="/1.88cb93a9.js" as="script">
<link rel="preload" href="/2.611b72e2.js" as="script">
<link rel="preload" href="/4.1459d7e9.js" as="script">
<link rel="preload" href="/a6aa9e1f.7bc73ca9.js" as="script">
<link rel="preload" href="/271584f9.65e5c66d.js" as="script">
<link rel="preload" href="/f9cf05c7.c2228a74.js" as="script">
<link rel="preload" href="/db4fee23.4dec3272.js" as="script">
<link rel="preload" href="/053dc805.b0b3beee.js" as="script">
<link rel="preload" href="/d1e50573.4f2d03d5.js" as="script">
<link rel="preload" href="/fcf09424.13a26563.js" as="script">
<link rel="preload" href="/b2b675dd.aa78c02e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">ihooks</strong></a><a class="navbar__item navbar__link" href="/docs/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://doranui.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">doranUI</a><a href="https://github.com/ximoThorn/ihooks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">ihooks</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://doranui.github.io" target="_blank" rel="noopener noreferrer" class="menu__link">doranUI</a></li><li class="menu__list-item"><a href="https://github.com/ximoThorn/ihooks" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_GFRE"><h3 class="sidebarItemTitle_3473">Recent posts</h3><ul class="sidebarItemList_117a"><li class="sidebarItem_2Wrv"><a class="sidebarItemLink_ZFZd" href="/blog/lerna">lerna</a></li><li class="sidebarItem_2Wrv"><a class="sidebarItemLink_ZFZd" href="/blog/react setState">react setState</a></li><li class="sidebarItem_2Wrv"><a class="sidebarItemLink_ZFZd" href="/blog/å‰ç«¯ç›‘æ§">å‰ç«¯ç›‘æ§</a></li><li class="sidebarItem_2Wrv"><a class="sidebarItemLink_ZFZd" href="/blog/react fiber">react fiber</a></li><li class="sidebarItem_2Wrv"><a class="sidebarItemLink_ZFZd" href="/blog/æµè§ˆå™¨çš„æ¸²æŸ“æœºåˆ¶">æµè§ˆå™¨çš„æ¸²æŸ“æœºåˆ¶</a></li></ul></div></div><main class="col col--8"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_2QPY"><a href="/blog/lerna">lerna</a></h2><div class="margin-vert--md"><time datetime="2022-03-20T00:00:00.000Z" class="blogPostDate_2nK8">March 20, 2022  Â· 1 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/ximoThorn" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/32925631?s=60&amp;v=4"></a><div class="avatar__intro"></div></div></header><section class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="lerna"></a>lerna<a aria-hidden="true" tabindex="-1" class="hash-link" href="#lerna" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="ä¸€ã€ä½¿ç”¨lerna"></a>ä¸€ã€ä½¿ç”¨lerna<a aria-hidden="true" tabindex="-1" class="hash-link" href="#ä¸€ã€ä½¿ç”¨lerna" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="å®‰è£…lerna"></a>å®‰è£…lerna<a aria-hidden="true" tabindex="-1" class="hash-link" href="#å®‰è£…lerna" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-bash codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> i lerna -g</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="åˆå§‹åŒ–é¡¹ç›®"></a>åˆå§‹åŒ–é¡¹ç›®<a aria-hidden="true" tabindex="-1" class="hash-link" href="#åˆå§‹åŒ–é¡¹ç›®" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-bash codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> lerna-project</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> lerna-project</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  lerna init</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="lernajson"></a>lerna.json<a aria-hidden="true" tabindex="-1" class="hash-link" href="#lernajson" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-json codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;packages&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;packages/*&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;version&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0.0.0&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="yarn-workspace"></a>yarn workspace<a aria-hidden="true" tabindex="-1" class="hash-link" href="#yarn-workspace" title="Direct link to heading">#</a></h3><blockquote><p>ç®¡ç†é¡¹ç›®å½¢æˆå·¥ä½œç©ºé—´</p><p>1ã€å°†node_modulesç›®å½•å®‰è£…åœ¨æ ¹ç›®å½•ä¸­ï¼Œå­é¡¹ç›®éƒ½å¯ä»¥è¯»åˆ°æ ¹ç›®å½•çš„node_modules
2ã€æ•´ä¸ªé¡¹ç›®åªæœ‰ä¸€ä¸ªyarn.lockæ–‡ä»¶
3ã€å­é¡¹ç›®ä¼šè¢«linkè‡³æ ¹ç›®å½•çš„node_modulesä¸­ï¼Œè¿™æ ·å…è®¸æˆ‘ä»¬åœ¨å­é¡¹ç›®ä¸­é€šè¿‡importç›´æ¥å¼•ç”¨å¦ä¸€ä¸ªå­é¡¹ç›®(éœ€æ‰§è¡Œyarn install)</p></blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="å¼€å¯workspace"></a>å¼€å¯workspace<a aria-hidden="true" tabindex="-1" class="hash-link" href="#å¼€å¯workspace" title="Direct link to heading">#</a></h4><blockquote><p>package.jsonæ–‡ä»¶è®¾ç½®workspaceså±æ€§</p></blockquote><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-json codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;root&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;private&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;workspaces&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;packages/*&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;devDependencies&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;lerna&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;^3.22.1&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="åˆ›å»ºå­é¡¹ç›®"></a>åˆ›å»ºå­é¡¹ç›®<a aria-hidden="true" tabindex="-1" class="hash-link" href="#åˆ›å»ºå­é¡¹ç›®" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-bash codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">lerna create ihooks</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–<a aria-hidden="true" tabindex="-1" class="hash-link" href="#å®‰è£…ä¾èµ–" title="Direct link to heading">#</a></h3><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ä¸èƒ½å¾€æ ¹ç›®å½•é‡Œé¢æ·»åŠ æ¨¡å—çš„ï¼Œæ‰§è¡ŒğŸ‘‡å‘½ä»¤ä¼šå¿½ç•¥æ ¹ç©ºé—´ä¾èµ–æ£€æŸ¥ï¼Œå°†node_moduleså®‰è£…åœ¨æ ¹ç›®å½•ä¸­</p><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-bash codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">yarn</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> chalk --ignore-workspace-root-check</span></div></div></div></div></div><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å°†å­é¡¹ç›®ç‹¬äº«çš„ä¾èµ–å®‰è£…åœ¨å­é¡¹ç›®ä¸­æ€ä¹ˆåŠå‘¢ï¼Ÿæ‰§è¡ŒğŸ‘‡é¢å‘½ä»¤</p><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-bash codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">yarn</span><span class="token plain"> workspace ihooks </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> loadsh</span></div></div></div></div></div></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="å­é¡¹ç›®å…±äº«ä¾èµ–"></a>å­é¡¹ç›®å…±äº«ä¾èµ–<a aria-hidden="true" tabindex="-1" class="hash-link" href="#å­é¡¹ç›®å…±äº«ä¾èµ–" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-js codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">yarn install</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æˆ–è€…</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">lerna bootstrap </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain">npm</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">client yarn </span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain">use</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">workspaces</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// --npm-client yarnä½¿ç”¨yarnä½œä¸ºnpmçš„å®¢æˆ·ç«¯</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="å…¶å®ƒå‘½ä»¤"></a>å…¶å®ƒå‘½ä»¤<a aria-hidden="true" tabindex="-1" class="hash-link" href="#å…¶å®ƒå‘½ä»¤" title="Direct link to heading">#</a></h3><table><thead><tr><th>ä½œç”¨</th><th>å‘½ä»¤</th><th></th></tr></thead><tbody><tr><td>æŸ¥çœ‹å­ç©ºé—´ä¿¡æ¯</td><td>yarn workspaces info</td><td></td></tr><tr><td>åˆ é™¤æ‰€æœ‰node_modules</td><td>lerna clean / yarn workspaces run clean</td><td></td></tr><tr><td>é‡æ–°è·å–æ‰€æœ‰çš„node_modules</td><td>yarn install --force</td><td></td></tr><tr><td>æŸ¥çœ‹ç¼“å­˜ç›®å½•</td><td>yarn cache dir</td><td></td></tr><tr><td>æ¸…é™¤æœ¬åœ°ç¼“å­˜</td><td>yarn cache clean</td><td></td></tr></tbody></table><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£<a aria-hidden="true" tabindex="-1" class="hash-link" href="#å‚è€ƒæ–‡æ¡£" title="Direct link to heading">#</a></h1><p><a href="https://yarn.bootcss.com/docs/cli/workspace/" target="_blank" rel="noopener noreferrer">yarn</a>ã€<a href="https://github.com/lerna/lerna" target="_blank" rel="noopener noreferrer">lerna</a></p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/npm">npm</a><a class="margin-horiz--sm" href="/blog/tags/yarn">yarn</a><a class="margin-horiz--sm" href="/blog/tags/lerna">lerna</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_2QPY"><a href="/blog/react setState">react setState</a></h2><div class="margin-vert--md"><time datetime="2022-03-20T00:00:00.000Z" class="blogPostDate_2nK8">March 20, 2022  Â· 2 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/ximoThorn" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/32925631?s=60&amp;v=4"></a><div class="avatar__intro"></div></div></header><section class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="react-setstateè¿‡ç¨‹"></a>react setStateè¿‡ç¨‹<a aria-hidden="true" tabindex="-1" class="hash-link" href="#react-setstateè¿‡ç¨‹" title="Direct link to heading">#</a></h1><blockquote><p>setStateæ˜¯æŒ‚åœ¨reactçš„Componentç»„ä»¶çš„åŸå‹ä¸Šï¼Œè¿™é‡Œè®°å½•ä¸‹setStateçš„æ‰§è¡Œè¿‡ç¨‹ï¼ŒåŒ…æ‹¬ä½•æ—¶è¡¨ç°ä¸ºå¼‚æ­¥ï¼Œä½•æ—¶è¡¨ç°ä¸ºåŒæ­¥</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="çª¥æ¢componenç»„ä»¶ï¼š"></a>çª¥æ¢Componenç»„ä»¶ï¼š<a aria-hidden="true" tabindex="-1" class="hash-link" href="#çª¥æ¢componenç»„ä»¶ï¼š" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-js codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> classComponentUpdater </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> /**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">     * instï¼šç»„ä»¶å®ä¾‹</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">     * payloadï¼šéœ€è¦æ›´æ–°çš„æ–°çŠ¶æ€</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">    */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">enqueueSetState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">inst</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> payload</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ ¹æ®å®ä¾‹è·å–å½“å‰fiberï¼Œreactçš„classç±»ç»„ä»¶çš„fiber.stateNodeæŒ‡å‘ç±»çš„å®ä¾‹ï¼Œå®ä¾‹çš„_reactInternalså±æ€§æŒ‡å‘å½“å‰fiber</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> fiber </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">inst</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// è¿™é‡Œä¼šæœ‰ç¡®è®¤ä¼˜å…ˆçº§çš„æ“ä½œ</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// let eventTime = requestEventTime()</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// let lane = requestUploadLane()</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> update </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createUpdate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">eventTime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> lane</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      update</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">payload</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> payload</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> /**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">       * updateæ˜¯ä¸€ä¸ªæ›´æ–°å¯¹è±¡,ä¾‹å¦‚ï¼š</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">       * </span><span class="token doc-comment comment punctuation" style="color:rgb(199, 146, 234);font-style:italic">{</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">       *    eventTime: ,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">       *    lane: ,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">       *    payload: </span><span class="token doc-comment comment punctuation" style="color:rgb(199, 146, 234);font-style:italic">{</span><span class="token doc-comment comment punctuation" style="color:rgb(199, 146, 234);font-style:italic">}</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">       *    callback: , // setStateç¬¬äºŒä¸ªå‚æ•°</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">       * </span><span class="token doc-comment comment punctuation" style="color:rgb(199, 146, 234);font-style:italic">}</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">      */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æŠŠå½“å‰updateæ·»åŠ åˆ°å½“å‰fiberçš„updateQueueï¼ˆé“¾è¡¨ï¼‰ä¸­</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token function" style="color:rgb(130, 170, 255)">enqueueUpdate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> update</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ‰§è¡Œfiberçš„è°ƒåº¦</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> root </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">scheduleUpdateOnFiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> lane</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> eventTime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Componentç»„ä»·çš„æ•´ä½“ç»“æ„</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Component</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">constructor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">updater</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> classComponentUpdater </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ›´æ–°å™¨</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">setState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">partialState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">updater</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">enqueueSetState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> partialState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>ç®€å•æ€»ç»“ä¸‹ï¼š</p><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-js codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><ol><li>æ‰§è¡ŒComponentåŸå‹ä¸ŠsetStateæ–¹æ³•</li><li>ä¼šåˆ›å»ºä¸€ä¸ªupdateå¯¹è±¡</li><li>å°†updateæ·»åŠ åˆ°å½“å‰fiberçš„updateQueueé“¾è¡¨ä¸Š</li><li>æ‰§è¡Œfiberçš„è°ƒåº¦æ›´æ–°å‡½æ•°scheduleUpdateOnFiber</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="scheduleupdateonfiberå‡½æ•°"></a>scheduleUpdateOnFiberå‡½æ•°<a aria-hidden="true" tabindex="-1" class="hash-link" href="#scheduleupdateonfiberå‡½æ•°" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-js codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">scheduleUpdateOnFiber</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">fiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ ¹æ®fiber.returnè·å–æ ¹fiberå¯¹è±¡</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> root </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">markUpdateLaneFromFiberToRoot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å¼€å§‹åˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œ</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">ensureRootIsScheduled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// é€’å½’è·å–root fiber</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">markUpdateLaneFromFiberToRoot</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">fiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> parent </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> fiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">parent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      fiber </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> parent</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      parent </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> parent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">return</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">tag</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> </span><span class="token maybe-class-name">HostRoot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> fiber</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token keyword null nil" style="font-style:italic">null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ensureRootIsScheduled</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// è¿™é‡Œä¼šå…ˆåˆ¤æ–­ä»»åŠ¡æ˜¯å¦ç›¸åŒå’Œç¡®è®¤ä¼˜å…ˆçº§</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// scheduleSyncCallbackæ–¹æ³•ä¼šæŠŠperformSyncWorkOnRootæ·»åŠ åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…åç»­æ‰§è¡Œ</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">scheduleSyncCallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">performSyncWorkOnRoot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">bind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword null nil" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">isBatchedUpdates</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å¦‚æœä¸æ˜¯æ‰¹é‡ï¼ˆå¼‚æ­¥ï¼‰æ›´æ–°</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// è¿›è¡ŒåŒæ­¥æ›´æ–°</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token function" style="color:rgb(130, 170, 255)">flushSyncCallbackQueue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// react17ä¸­ä¸æ˜¯é€šè¿‡isBatchedUpdatesåˆ¤æ–­çš„ï¼Œä½†æ˜¯åŸç†ç›¸åŒ</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">batchedUpdates</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">fn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">fn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    isBatchedUpdates </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">flushSyncCallbackQueue</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    syncQueue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">forEach</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">cb</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">cb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    syncQueue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// é˜Ÿåˆ—ç½®ç©º</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">scheduleSyncCallback</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">cb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    syncQueue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>scheduleUpdateOnFiberå‡½æ•°æ€»ç»“ï¼š</p><ol><li>å‘ä¸Šé€’å½’è·å–root fiberï¼Œä»æ ¹fiberå¼€å§‹æ‰§è¡Œä»»åŠ¡</li><li>åˆ¤æ–­ä»»åŠ¡æ˜¯å¦é‡å¤ï¼Œå¹¶ä¸”ç¡®è®¤ä¼˜å…ˆçº§ï¼ŒæŠŠä»»åŠ¡æ·»åŠ åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…åç»­æ‰§è¡Œ</li><li>åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰¹é‡ï¼ˆå¼‚æ­¥ï¼‰æ›´æ–°ï¼Œå¦‚æœä¸æ˜¯å°±æ‰§è¡ŒflushSyncCallbackQueueè¿›è¡ŒåŒæ­¥æ›´æ–°</li></ol><blockquote><p><strong>æ³¨ï¼šåœ¨reactåˆæˆäº‹ä»¶ä¸­ä¼šé»˜è®¤æ‰§è¡ŒbatchedUpdates()å‡½æ•°è¿›è¡Œæ‰¹é‡ï¼ˆå¼‚æ­¥ï¼‰æ›´æ–°ï¼Œæ‰§è¡Œå®Œåå°†isBatchedUpdatesç½®ä¸ºfalseï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†æ”¾åœ¨setTimeoutä¸­çš„setStateä¼šåŒæ­¥æ›´æ–°</strong></p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="performsyncworkonrootå‡½æ•°"></a>performSyncWorkOnRootå‡½æ•°<a aria-hidden="true" tabindex="-1" class="hash-link" href="#performsyncworkonrootå‡½æ•°" title="Direct link to heading">#</a></h2><p>performSyncWorkOnRootå‡½æ•°æ˜¯çœŸæ­£çš„æ¸²æŸ“ä»»åŠ¡äº†</p><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-js codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">performSyncWorkOnRoot</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> root </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> workInProgress</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">tag</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> classComponent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> inst </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">stateNode</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//å°†å½“å‰fiberä¸Šçš„updateQueueä¸­çš„å„ä¸ªè¦æ›´æ–°çš„æ–°stateå’Œå®ä¾‹ä¸­çš„è€çš„stateè¿›è¡Œåˆå¹¶</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        inst</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">state</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">processUpdateQueue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">inst</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å¾—åˆ°åˆå¹¶åçš„æ–°stateåæ‰§è¡Œå®ä¾‹çš„renderæ–¹æ³•ï¼Œå¾—åˆ°æ–°çš„VDomï¼Œç„¶åè¿›è¡Œdom diffï¼Œæ›´æ–°Dom</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        inst</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">render</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      workInProgress </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">child</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">commitRoot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æäº¤é˜¶æ®µï¼Œå¹¶é‡ç½®ä»»åŠ¡ä¼˜å…ˆçº§</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>performSyncWorkOnRootå‡½æ•°æ€»ç»“ï¼š</p><ol><li>ä»æ ¹fiberå¼€å§‹é€’å½’æ‰§è¡Œï¼Œå°†æ¯ä¸ªclassComponentçš„stateè¿›è¡Œåˆå¹¶ï¼Œå¹¶æ‰§è¡Œrender</li><li>æäº¤é˜¶æ®µï¼Œé‡ç½®ä»»åŠ¡ä¼˜å…ˆçº§</li></ol></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/react">react</a><a class="margin-horiz--sm" href="/blog/tags/set-state">setState</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_2QPY"><a href="/blog/å‰ç«¯ç›‘æ§">å‰ç«¯ç›‘æ§</a></h2><div class="margin-vert--md"><time datetime="2021-02-23T00:00:00.000Z" class="blogPostDate_2nK8">February 23, 2021  Â· 1 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/ximoThorn" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/32925631?s=60&amp;v=4"></a><div class="avatar__intro"></div></div></header><section class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="å‰ç«¯ç›‘æ§"></a>å‰ç«¯ç›‘æ§<a aria-hidden="true" tabindex="-1" class="hash-link" href="#å‰ç«¯ç›‘æ§" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="ä¸€ã€ä¸ºä»€ä¹ˆè¦åšç›‘æ§"></a>ä¸€ã€ä¸ºä»€ä¹ˆè¦åšç›‘æ§<a aria-hidden="true" tabindex="-1" class="hash-link" href="#ä¸€ã€ä¸ºä»€ä¹ˆè¦åšç›‘æ§" title="Direct link to heading">#</a></h2><ol><li>æ›´å¿«å‘ç°é—®é¢˜å¹¶è§£å†³é—®é¢˜</li><li>åšäº§å“çš„å†³ç­–ä¾æ®</li><li>æå‡å‰ç«¯å·¥ç¨‹å¸ˆçš„æŠ€æœ¯æ·±åº¦å’Œå¹¿åº¦ï¼Œæ‰“é€ ç®€å†äº®ç‚¹</li><li>ä¸ºä¸šåŠ¡æ‹“å±•æä¾›äº†æ›´å¤šå¯èƒ½æ€§</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="äºŒã€å‰ç«¯ç›‘æ§ç›®æ ‡"></a>äºŒã€å‰ç«¯ç›‘æ§ç›®æ ‡<a aria-hidden="true" tabindex="-1" class="hash-link" href="#äºŒã€å‰ç«¯ç›‘æ§ç›®æ ‡" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="1ã€ç¨³å®šæ€§ï¼ˆstabilityï¼‰"></a>1ã€ç¨³å®šæ€§ï¼ˆstabilityï¼‰<a aria-hidden="true" tabindex="-1" class="hash-link" href="#1ã€ç¨³å®šæ€§ï¼ˆstabilityï¼‰" title="Direct link to heading">#</a></h3><table><thead><tr><th>é”™è¯¯åç§°</th><th>å¤‡æ³¨</th><th></th></tr></thead><tbody><tr><td>JSé”™è¯¯</td><td>JSæ‰§è¡Œé”™è¯¯æˆ–è€…promiseå¼‚å¸¸</td><td></td></tr><tr><td>èµ„æºå¼‚å¸¸</td><td>scriptæˆ–è€…linkèµ„æºåŠ è½½å¼‚å¸¸</td><td></td></tr><tr><td>æ¥å£é”™è¯¯</td><td>ajaxæˆ–è€…fetchè¯·æ±‚æ¥å£å¼‚å¸¸</td><td></td></tr><tr><td>ç™½å±</td><td>é¡µé¢ç©ºç™½</td><td></td></tr></tbody></table><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-js codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// jsæ‰§è¡Œåºé”™è¯¯å’Œèµ„æºåŠ è½½ é”™è¯¯å¯ä»¥é€šè¿‡ç›‘å¬erroräº‹ä»¶æ¥æ•è·</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token dom variable" style="color:rgb(191, 199, 213)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">addEventListener</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;error&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">target</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">href</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// èµ„æºåŠ è½½é”™è¯¯</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// jsæ‰§è¡Œé”™è¯¯</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// promiseå¼‚å¸¸, å¯ä»¥é€šè¿‡ç›‘å¬unhandledrejectionäº‹ä»¶æ¥æ•è·</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token dom variable" style="color:rgb(191, 199, 213)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">addEventListener</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;unhandledrejection&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token console class-name" style="color:rgb(255, 203, 107)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="2ã€ç”¨æˆ·ä½“éªŒexperience"></a>2ã€ç”¨æˆ·ä½“éªŒ(experience)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#2ã€ç”¨æˆ·ä½“éªŒexperience" title="Direct link to heading">#</a></h3><table><thead><tr><th>é”™è¯¯åç§°</th><th>å¤‡æ³¨</th><th></th></tr></thead><tbody><tr><td>åŠ è½½æ—¶é—´</td><td>å„ä¸ªé˜¶æ®µçš„åŠ è½½æ—¶é—´</td><td></td></tr><tr><td>fFB(tim to first byte)(é¦–å­—èŠ‚æ—¶é—´)</td><td>æ˜¯æŒ‡æµè§ˆå™¨å‘èµ·ç¬¬ä¸€ä¸ªè¯·æ±‚åˆ°æ•°æ®è¿”å›ç¬¬ä¸€ä¸ªå­—èŠ‚æ‰€æ¶ˆè€—çš„æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´åŒ…å«äº†ç½‘ç»œè¯·æ±‚æ—¶é—´ã€åç«¯å¤„ç†æ—¶é—´</td><td></td></tr><tr><td>FP(First Paint)(é¦–æ¬¡ç»˜åˆ¶)</td><td>é¦–æ¬¡ç»˜åˆ¶åŒ…æ‹¬äº†ä»»ä½•ç”¨æˆ·è‡ªå®šä¹‰çš„èƒŒæ™¯ç»˜åˆ¶ï¼Œå®ƒæ˜¯å°†ç¬¬ä¸€ä¸ªåƒç´ ç‚¹ç»˜åˆ¶åˆ°å±å¹•çš„æ—¶åˆ»</td><td></td></tr><tr><td>FCP(First Content Paint)(é¦–æ¬¡å†…å®¹ç»˜åˆ¶)</td><td>é¦–æ¬¡å†…å®¹ç»˜åˆ¶æ˜¯æµè§ˆå™¨å°†ç¬¬ä¸€ä¸ªDOMæ¸²æŸ“åˆ°å±å¹•çš„æ—¶é—´ï¼Œå¯ä»¥æ˜¯ä»»ä½•æ–‡æœ¬ã€å›¾åƒã€SVGç­‰çš„æ—¶é—´</td><td></td></tr><tr><td>FMP(First Meaningful paint)(é¦–æ¬¡æœ‰æ„ä¹‰ç»˜åˆ¶)</td><td>é¦–æ¬¡æœ‰æ„ä¹‰ç»˜åˆ¶æ˜¯é¡µé¢å¯ç”¨æ€§çš„é‡åº¦æ ‡å‡†</td><td></td></tr><tr><td>FID(First Input Delay)(é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ</td><td>ç”¨æˆ·é¦–æ¬¡å’Œé¡µé¢äº¤äº’åˆ°é¡µé¢å“åº”äº¤äº’çš„æ—¶é—´</td><td></td></tr><tr><td>å¡é¡¿</td><td>è¶…è¿‡50msçš„é•¿ä»»åŠ¡</td><td></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="3ã€ä¸šåŠ¡business"></a>3ã€ä¸šåŠ¡(business)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#3ã€ä¸šåŠ¡business" title="Direct link to heading">#</a></h3><table><thead><tr><th>é”™è¯¯åç§°</th><th>å¤‡æ³¨</th><th></th></tr></thead><tbody><tr><td>PV</td><td>page viewå³é¡µé¢æµè§ˆé‡æˆ–ç‚¹å‡»é‡</td><td></td></tr><tr><td>UV</td><td>æŒ‡è®¿é—®æŸä¸ªç«™ç‚¹çš„ä¸åŒIPåœ°å€çš„äººæ•°</td><td></td></tr><tr><td>é¡µé¢çš„åœç•™æ—¶é—´</td><td>ç”¨æˆ·åœ¨æ¯ä¸€ä¸ªé¡µé¢çš„åœç•™æ—¶é—´</td><td></td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="ä¸‰ã€å‰ç«¯ç›‘æ§æµç¨‹"></a>ä¸‰ã€å‰ç«¯ç›‘æ§æµç¨‹<a aria-hidden="true" tabindex="-1" class="hash-link" href="#ä¸‰ã€å‰ç«¯ç›‘æ§æµç¨‹" title="Direct link to heading">#</a></h2><ol><li>å‰ç«¯åŸ‹ç‚¹</li><li>æ•°æ®ä¸ŠæŠ¥</li><li>åˆ†æå’Œè®¡ç®— å°†é‡‡é›†åˆ°çš„æ•°æ®è¿›è¡ŒåŠ å·¥å’Œæ±‡æ€»</li><li>å¯è§†åŒ–å±•ç¤º å°†æ•°æ®æŒ‰ç…§å„ç§ç»´åº¦è¿›è¡Œå±•ç¤º</li><li>ç›‘æ§æŠ¥è­¦ å‘ç°é—®é¢˜åæŒ‰ç…§ä¸€å®šçš„æ¡ä»¶è§¦å‘æŠ¥è­¦</li></ol><p><img alt="maidian" src="/assets/images/maidian-48c593f1e80984c28de78d3fc923953c.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="å››ã€å¸¸è§åŸ‹ç‚¹æ–¹æ¡ˆ"></a>å››ã€å¸¸è§åŸ‹ç‚¹æ–¹æ¡ˆ<a aria-hidden="true" tabindex="-1" class="hash-link" href="#å››ã€å¸¸è§åŸ‹ç‚¹æ–¹æ¡ˆ" title="Direct link to heading">#</a></h2><ol><li>ä»£ç åŸ‹ç‚¹</li></ol><ul><li>å°±æ˜¯ä»¥åµŒå…¥ä»£ç çš„å½¢å¼è¿›è¡ŒåŸ‹ç‚¹æ¯”å¦‚éœ€è¦ç›‘æ§ç”¨æˆ·çš„ç‚¹å‡»äº‹ä»¶ï¼Œä¼šé€‰æ‹©åœ¨ç”¨æˆ·ç‚¹å‡»æ—¶ï¼Œæ’å…¥ä¸€æ®µä»£ç ï¼Œä¿å­˜è¿™ä¸ªç›‘å¬è¡Œä¸ºæˆ–è€…ç›´æ¥å°†ç›‘å¬è¡Œä¸ºä»¥æŸä¸€ç§æ•°æ®æ ¼å¼ç›´æ¥ä¼ é€’ç»™æœåŠ¡å™¨ç«¯</li><li>ä¼˜ç‚¹ï¼šå¯ä»¥åœ¨ä»»æ„æ—¶åˆ»ï¼Œç²¾ç¡®çš„å‘é€æˆ–ä¿å­˜æ‰€éœ€è¦çš„æ•°æ®ä¿¡æ¯ï¼›</li><li>ç¼ºç‚¹ï¼šå·¥ä½œé‡è¾ƒå¤§</li></ul><ol start="2"><li>å¯è§†åŒ–åŸ‹ç‚¹</li></ol><ul><li>é€šè¿‡å¯è§†åŒ–äº¤äº’çš„æ‰‹æ®µï¼Œä»£æ›¿ä»£ç åŸ‹ç‚¹</li><li>å°†ä¸šåŠ¡ä»£ç å’ŒåŸ‹ç‚¹ä»£ç åˆ†ç¦»ï¼Œæä¾›ä¸€ä¸ªå¯è§†åŒ–äº¤äº’çš„é¡µé¢ï¼Œè¾“å…¥ä¸ºä¸šåŠ¡ä»£ç ï¼Œé€šè¿‡è¿™ä¸ªå¯è§†åŒ–ç³»ç»Ÿï¼Œå¯ä»¥åœ¨ä¸šåŠ¡ä»£ç ä¸­è‡ªå®šä¹‰çš„å¢åŠ åŸ‹ç‚¹äº‹ä»¶ç­‰ç­‰,æœ€åè¾“å‡ºçš„ä»£ç å¶åˆäº†ä¸šåŠ¡ä»£ç å’ŒåŸ‹ç‚¹ä»£ç </li><li>å¯è§†åŒ–åŸ‹ç‚¹å…¶å®æ˜¯ç”¨ç³»ç»Ÿæ¥ä»£æ›¿æ‰‹å·¥æ’å…¥åŸ‹ç‚¹ä»£ç </li></ul><ol start="3"><li>æ— ç—•åŸ‹ç‚¹</li></ol><ul><li>å‰ç«¯çš„ä»»æ„ä¸€ä¸ªäº‹ä»¶éƒ½è¢«ç»‘å®šä¸€ä¸ªæ ‡è¯†ï¼Œæ‰€æœ‰çš„äº‹ä»¶éƒ½åˆ«è®°å½•ä¸‹æ¥</li><li>é€šè¿‡å®šæœŸä¸Šä¼ è®°å½•æ–‡ä»¶ï¼Œé…åˆæ–‡ä»¶è§£æï¼Œè§£æå‡ºæ¥æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ï¼Œå¹¶ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Šä¾›ä¸“ä¸šäººå‘˜åˆ†æ</li><li>æ— ç—•åŸ‹ç‚¹çš„ä¼˜ç‚¹æ˜¯é‡‡é›†å…¨é‡æ•°æ®ï¼Œä¸ä¼šå‡ºç°æ¼åŸ‹å’Œè¯¯åŸ‹ç­‰ç°è±¡</li><li>ç¼ºç‚¹æ˜¯ç»™æ•°æ®ä¼ è¾“å’ŒæœåŠ¡å™¨å¢åŠ å‹åŠ›ï¼Œä¹Ÿæ— æ³•çµæ´»å®šåˆ¶æ•°æ®ç»“æ„</li></ul></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/æ€§èƒ½">æ€§èƒ½</a><a class="margin-horiz--sm" href="/blog/tags/javascript">javascript</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_2QPY"><a href="/blog/react fiber">react fiber</a></h2><div class="margin-vert--md"><time datetime="2021-01-30T00:00:00.000Z" class="blogPostDate_2nK8">January 30, 2021  Â· 2 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/ximoThorn" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/32925631?s=60&amp;v=4"></a><div class="avatar__intro"></div></div></header><section class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="react-fiber"></a>react fiber<a aria-hidden="true" tabindex="-1" class="hash-link" href="#react-fiber" title="Direct link to heading">#</a></h1><p>åœ¨v15å’Œä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œåœ¨reactä»»æ„ä¸€ä¸ªåœ°æ–¹æ‰§è¡ŒsetStateåï¼Œreactä¼šå¯¹æ•´ä¸ªé¡µé¢åˆ›å»ºè™šæ‹Ÿdomï¼Œå¹¶å¯¹å‰ådomè¿›è¡Œdiffå¯¹æ¯”ï¼Œç„¶åè¿›è¡Œæ¸²æŸ“ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯â€œä¸€æ°”å‘µæˆâ€çš„ï¼Œæ‰€ä»¥å®ƒå æ®äº†ä¸»çº¿ç¨‹çš„å¤§é‡æ—¶é—´ï¼Œè¿™ä¼šä½¿é¡µé¢å“åº”åº¦å˜å·®ï¼Œä¹Ÿå°±å¯¼è‡´äº†reactåœ¨æ¸²æŸ“åŠ¨ç”»ï¼Œæˆ–è€…æ‰‹åŠ¿æ“ä½œæ—¶ä¼šå‡ºç°å¡é¡¿ç°è±¡ï¼Œå› æ­¤reactå›¢é˜Ÿåœ¨reactçš„v16ç‰ˆæœ¬åé‡‡ç”¨äº†fiberæ¶æ„ã€‚</p><p>ç†Ÿæ‚‰fiberä¹‹å‰éœ€è¦å…ˆäº†è§£å‡ ä¸ªåŸºç¡€çŸ¥è¯†ï¼š<strong>window.requestIdleCallback</strong>ï¼Œ<strong>å•é“¾è¡¨</strong>
<img src="https://user-images.githubusercontent.com/32925631/90331506-89c43c80-dfe7-11ea-9f1a-1934ed6a013f.png" alt="image"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="å¸§ç‡"></a>å¸§ç‡<a aria-hidden="true" tabindex="-1" class="hash-link" href="#å¸§ç‡" title="Direct link to heading">#</a></h2><p>æˆ‘ä»¬çŸ¥é“å±å¹•æµè§ˆå™¨åˆ·æ–°ç‡60å¸§/sï¼Œå¹³å‡16.6ms/å¸§ï¼Œåœ¨ä¸€å¸§ä¸­æµè§ˆå™¨åšäº†å¾ˆå¤šäº‹æƒ…ï¼š</p><p>åœ¨æµè§ˆå™¨æ‰§è¡Œä¸€å¸§çš„è¿‡ç¨‹ä¸­ï¼š</p><ol><li><p>Input event handlersï¼šåˆæˆçº¿ç¨‹ compositor thread æŠŠ input æ•°æ®ä¼ ç»™ä¸»çº¿ç¨‹ï¼Œ å¤„ç†äº‹ä»¶å›è°ƒã€‚</p></li><li><p>javascript: åŒ…æ‰©å®šæ—¶å™¨ã€äº‹ä»¶ï¼ˆscrollï¼Œresizeç­‰ï¼‰ã€requestAnimationFrameã€é‡æ’ï¼ˆlayoutï¼‰ã€é‡ç»˜ï¼ˆpaintï¼‰</p></li><li><p>å¦‚æœåœ¨ä¸€å¸§å†…ï¼Œæ‰§è¡Œå®Œä¸Šè¿°æ‰€æœ‰ä»»åŠ¡åï¼Œè¿˜æœ‰å‰©ä½™æ—¶é—´çš„è¯ï¼Œé‚£å°±ä¼šæ‰§è¡ŒrequestIdleCallbackå›è°ƒï¼Œ</p></li></ol><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-js codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token dom variable" style="color:rgb(191, 199, 213)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">requestIdleCallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// callback(deadline): ä¸€ä¸ªfunction ç”¨æˆ·è¦æ‰§è¡Œçš„å›è°ƒä»»åŠ¡, å¹¶ä¼ å…¥ä¸€ä¸ªå‚æ•°deadline</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//  deadline: {</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//  timeRemaining: 0ms, // å½“å‰å¸§è¿˜å‰©ä½™å¤šå°‘æ—¶é—´</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//  didTimeout: false, // æ˜¯å¦å·²è¶…æ—¶</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//  }</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// options: // ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥è®¾ç½®timeoutæ—¶é—´ï¼šè¶…è¿‡è¿™ä¸ªæ—¶é—´åï¼Œä¸ç®¡å½“å‰æ˜¯å¦æœ‰å‰©ä½™æ—¶é—´å¿…é¡»æ‰§è¡Œæ­¤å›è°ƒ</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><blockquote><p>å› ä¸ºrequestIdleCallbackå…¼å®¹æ€§å·®ï¼Œæ‰€ä»¥reactå†…éƒ¨å¹¶ä¸æ˜¯ç›´æ¥ç”¨è¿™ä¸ªapiï¼Œè€Œæ˜¯è‡ªå·±å®ç°äº†è¿™ä¸ªapiï¼Œç†è®ºæ•ˆæœæ˜¯ä¸€æ ·çš„</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="å•é“¾è¡¨"></a>å•é“¾è¡¨<a aria-hidden="true" tabindex="-1" class="hash-link" href="#å•é“¾è¡¨" title="Direct link to heading">#</a></h2><p>åœ¨fiberä¸­æœ‰å¤§é‡çš„å•é“¾è¡¨ï¼Œç”¨ä¸€å¼ å›¾è¡¨ç¤ºï¼š</p><p><img src="https://user-images.githubusercontent.com/32925631/90331514-a19bc080-dfe7-11ea-9c2e-c30f3689455b.png" alt="image"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="é‡å›fiber"></a>é‡å›fiber<a aria-hidden="true" tabindex="-1" class="hash-link" href="#é‡å›fiber" title="Direct link to heading">#</a></h2><p><strong>1.é€šè¿‡fiberåˆç†åˆ†é…cpuèµ„æºï¼Œæé«˜ç”¨æˆ·ç›¸åº”é€Ÿåº¦ï¼›2.é€šè¿‡fiberå¯ä»¥ä½¿reconciliationï¼ˆä¸€ç§diffç®—æ³•ï¼‰å¯ä»¥ä¸­æ–­ï¼Œäº¤å‡ºä¸»çº¿ç¨‹ï¼Œå»æ‰§è¡Œæ›´é‡è¦çš„äº‹æƒ…ï¼ˆæ¸²æŸ“ï¼Œäº¤äº’ç­‰ï¼‰</strong></p><p>é‚£ä¹ˆfiberæ˜¯ä»€ä¹ˆï¼šfiberæ˜¯ä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç»“æ„</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="æ‰§è¡Œå•å…ƒfiber"></a>æ‰§è¡Œå•å…ƒfiber<a aria-hidden="true" tabindex="-1" class="hash-link" href="#æ‰§è¡Œå•å…ƒfiber" title="Direct link to heading">#</a></h3><p>æ¯æ¬¡æµè§ˆå™¨æ‰§è¡Œå®Œä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œreactå°±ä¼šæ£€æŸ¥æ—¶å€™è¿˜æœ‰å‰©ä½™æ—¶é—´ï¼ˆæ¯ä¸€å¸§éƒ½ä¼šå»æ£€æŸ¥ï¼‰ï¼Œå¦‚æœæ²¡æœ‰ï¼Œreactå°±æ”¾æƒç»™æµè§ˆå™¨</p><p><img src="https://user-images.githubusercontent.com/32925631/90331527-bf692580-dfe7-11ea-8719-2d1066ba8be0.png" alt="image"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="æ•°æ®æœºæ„fiber"></a>æ•°æ®æœºæ„fiber<a aria-hidden="true" tabindex="-1" class="hash-link" href="#æ•°æ®æœºæ„fiber" title="Direct link to heading">#</a></h3><p>reactä½¿ç”¨é“¾è¡¨ï¼Œå°†æ¯ä¸€ä¸ªVirtualDomèŠ‚ç‚¹åŠå…¶å†…éƒ¨æ‰€æœ‰å­ï¼ˆä¸æ˜¯å­™å­ï¼‰èŠ‚ç‚¹è¡¨ç¤ºä¸ºä¸€ä¸ªfiberã€‚å¦‚å›¾ï¼š
<img src="https://user-images.githubusercontent.com/32925631/90331536-d14ac880-dfe7-11ea-9a24-f39fd629fd6f.png" alt="image"></p><p>å…¶ä¸­A1&gt;B1+B2å°±æ˜¯ä¸€ä¸ªfiberï¼ŒB1&gt;C1+C2æ˜¯ä¸€ä¸ªfiber</p><p>æ¯ä¸ªfiberå…¶å®å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé™¤äº†ä¸€äº›å±æ€§è¿˜åŒ…æ‹¬ä¸‰ä¸ªæŒ‡é’ˆ</p><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-js codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> fiber </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//å½“å‰èŠ‚ç‚¹ç±»å‹ï¼Œæ–‡æœ¬è¿˜æ˜¯dom</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ROOT&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å”¯ä¸€æ ‡è¯†</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å½“å‰å…ƒç´ ç±»å‹ï¼Œspanã€div</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  stateNode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// fiberå¯¹åº”çš„nodeèŠ‚ç‚¹</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  flag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// placementç­‰ï¼Œå‰¯ä½œç”¨ç±»å‹ï¼Œä¾‹å¦‚ï¼š å¢åˆ æ”¹æŸ¥</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  firstEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token keyword null nil" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  lastEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token keyword null nil" style="font-style:italic">null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ä¸‰ä¸ªæŒ‡é’ˆ</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  child</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æŒ‡å‘å½“å‰ç¬¬ä¸€ä¸ªå­fiber</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  sibling</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æŒ‡å‘å½“å‰ç´§æŒ¨ç€çš„å…„å¼Ÿfiber</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æŒ‡å‘å½“å‰çš„çˆ¶fiber</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="reactçš„æ„å»ºè¿‡ç¨‹"></a>reactçš„æ„å»ºè¿‡ç¨‹<a aria-hidden="true" tabindex="-1" class="hash-link" href="#reactçš„æ„å»ºè¿‡ç¨‹" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_2m49"><div class="codeBlockContent_2KFf"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_pWMR">Copy</button><div class="prism-code language-js codeBlock_1tif"><div class="codeBlockLines_2_Ao" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æµè§ˆå™¨ç©ºé—²æ—¶é—´æ‰§è¡Œ</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">requestIdleCallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workLoop</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//reactä¸­æ˜¯é€šè¿‡requestAnimationFrameå’ŒMessageChannelå®ç°çš„</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> rootFiber </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> workInProgress </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> rootFiber </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//å½“å‰æ­£åœ¨æ‰§è¡Œçš„å·¥ä½œå•å…ƒï¼ˆfiberï¼‰</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">workLoop</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">deadLine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// deadLineæ¯å¸§å‰©ä½™æ—¶é—´å¯¹è±¡</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> deadLine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">timeRemaining</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      workInProgress </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">performUnitOfWork</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ¯ä¸ªä»»åŠ¡å•å…ƒæ‰§è¡Œå®Œæ¯•åè¿”å›ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„ä»»åŠ¡å•å…ƒ</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æäº¤é˜¶æ®µ</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">commitRoot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rootFiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">performUnitOfWork</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">beginWork</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// åˆ›å»ºå­fiberæ ‘</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">child</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">child</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ä¼˜å…ˆæ„å»ºchild</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token function" style="color:rgb(130, 170, 255)">completeUnitWork</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å½“å‰å·¥ä½œå•å…ƒå®Œæˆæ„å»ºï¼Œå¹¶ç”Ÿæˆdom</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">sibling</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">sibling</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ²¡æœ‰childï¼Œæ„å»ºsibling</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      workInProgress </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">return</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æœ€åæ²¡æœ‰çˆ¶å…ƒç´ ï¼ˆrootï¼‰é€€å‡ºå¾ªç¯</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å¼€å§‹åˆ›å»ºå­Fiberæ ‘ğŸŒ²</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">beginWork</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> nextChildren </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">children</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">reconcileChildren</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> nextChildren</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">reconcileChildren</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">returnFiber</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> nextChildren</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ ¹æ®VDomç”Ÿæˆfiberçš„åŒæ—¶å¹¶æ„å»ºfiberé“¾(å°±æ˜¯ç»™fiberçš„childï¼Œsibline, returnå±æ€§èµ‹å€¼)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> nextChildren</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> newFiber </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createFiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">nextChildren</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// åˆ›å»ºfiber</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createFiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">element</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">TAG_HOST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> element</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      props</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> element</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> element</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">completeUnitWork</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">switch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">tag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">TAG_HOST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">createStateNode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ ¹æ®fiberç”ŸæˆçœŸå®domèŠ‚ç‚¹</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å®Œæˆæ—¶åˆ¤æ–­æœ‰æ²¡æœ‰å¯¹åº”çš„domæ“ä½œï¼Œæœ‰çš„è¯æ·»åŠ åˆ°å‰¯ä½œç”¨é“¾è¡¨ä¸­</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">makeEffectList</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">makeEffectList</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">workInProgress</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// æ ¹æ®æ¯ä¸ªfiberçš„firstEffectå’ŒlastEffectä»¥åŠflags</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å½’å¹¶fiberæ ‘ä¸­å„fiberçš„å‰¯ä½œç”¨ï¼Œå½¢æˆå‰¯ä½œç”¨é“¾</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// firstEffect -&gt; nextEffect -&gt; ... -&gt; lastEffect</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">commitRoot</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">rootFiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> currentEffect </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> rootFiber</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">firstEffect</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">currentEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">switch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">currentEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">flags</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å‰¯ä½œç”¨ç±»å‹</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token maybe-class-name">Placement</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">commitPlacemen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">currentEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// å‘çˆ¶domæ·»åŠ å­dom</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      currentEffect </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> currentEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">nextEffect</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">commitPlacemen</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">currentEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> parent </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> currentEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">return</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">stateNode</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    parent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">appendChild</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">currentEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">stateNode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="æ€»ç»“"></a>æ€»ç»“<a aria-hidden="true" tabindex="-1" class="hash-link" href="#æ€»ç»“" title="Direct link to heading">#</a></h2><p>reactå°†jsxç»è¿‡createElementå¤„ç†å½¢æˆè™šæ‹ŸdomèŠ‚ç‚¹åçš„è¿›è¡Œæ¸²æŸ“ï¼Œä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š
diffé˜¶æ®µå’Œcommité˜¶æ®µï¼š
åœ¨diffé˜¶æ®µè¿›è¡Œæ–°æ—§è™šæ‹Ÿdomå¯¹æ¯”ï¼Œè¿›è¡Œæ›´æ–°ï¼Œå¢é‡æˆ–è€…åˆ é™¤ï¼Œå¹¶ä¸”æ ¹æ®è™šæ‹Ÿdomç”Ÿæˆfiberæ ‘</p><blockquote><p>diffé˜¶æ®µå¯ä»¥æš‚åœï¼Œå› ä¸ºdiffé˜¶æ®µæ¯”è¾ƒèŠ±æ—¶é—´ï¼Œreactä¼šå¯¹ä»»åŠ¡è¿›è¡Œæ‹†åˆ†</p></blockquote><p>commité˜¶æ®µè¿›è¡ŒDOMçš„æ›´æ–°åˆ›å»ºï¼Œæ­¤é˜¶æ®µä¸èƒ½æš‚åœï¼Œéœ€è¦â€œä¸€æ°”å‘µæˆâ€</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/react">react</a><a class="margin-horiz--sm" href="/blog/tags/javascript">javascript</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_2QPY"><a href="/blog/æµè§ˆå™¨çš„æ¸²æŸ“æœºåˆ¶">æµè§ˆå™¨çš„æ¸²æŸ“æœºåˆ¶</a></h2><div class="margin-vert--md"><time datetime="2020-09-18T00:00:00.000Z" class="blogPostDate_2nK8">September 18, 2020  Â· 1 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/ximoThorn" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/32925631?s=60&amp;v=4"></a><div class="avatar__intro"></div></div></header><section class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="æµè§ˆå™¨çš„æ¸²æŸ“æœºåˆ¶"></a>æµè§ˆå™¨çš„æ¸²æŸ“æœºåˆ¶<a aria-hidden="true" tabindex="-1" class="hash-link" href="#æµè§ˆå™¨çš„æ¸²æŸ“æœºåˆ¶" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="æµè§ˆå™¨è¾“å…¥urlï¼ŒæŒ‰å›è½¦åçš„è¿‡ç¨‹"></a>æµè§ˆå™¨è¾“å…¥urlï¼ŒæŒ‰å›è½¦åçš„è¿‡ç¨‹<a aria-hidden="true" tabindex="-1" class="hash-link" href="#æµè§ˆå™¨è¾“å…¥urlï¼ŒæŒ‰å›è½¦åçš„è¿‡ç¨‹" title="Direct link to heading">#</a></h2><p><img src="https://user-images.githubusercontent.com/32925631/93556609-b505c700-f9ab-11ea-9908-6244bb457225.jpg" alt="46dd9fff4eca81e7"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="æµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹"></a>æµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹<a aria-hidden="true" tabindex="-1" class="hash-link" href="#æµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹" title="Direct link to heading">#</a></h2><p>æµè§ˆå™¨çš„æ¸²æŸ“ä¾é <strong>æµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“</strong>å’Œ<strong>æµè§ˆå™¨ä¾èµ–çš„æ¨¡å—</strong>çš„å…±åŒåä½œï¼Œæ‰èƒ½æŠŠä¸€ä¸ªç½‘é¡µç”Ÿæˆå‡ºæ¥
æµè§ˆå™¨çš„æ¸²æŸ“å¼•æ“ä¸»è¦åŒ…æ‹¬ï¼šHTMLè§£é‡Šå™¨ã€CSSè§£é‡Šå™¨ã€å¸ƒå±€å’ŒJavaScriptå¼•æ“ç­‰
æµè§ˆå™¨ä¾èµ–çš„æ¨¡å—ä¸»è¦åŒ…æ‹¬ï¼šç½‘ç»œï¼Œå­˜å‚¨ï¼Œ2D/3D å›¾å½¢ï¼ŒéŸ³é¢‘å’Œè§†é¢‘ï¼Œå›¾ç‰‡è§£ç å™¨ç­‰
<img src="https://user-images.githubusercontent.com/32925631/93556677-df578480-f9ab-11ea-8e73-3e0164966be5.jpg" alt="1628f1a408ef0436"></p><p>å¤§è‡´çš„æ¸²æŸ“è¿‡ç¨‹åŠä¾èµ–æ¨¡å—å…³ç³»å›¾:
<img src="https://user-images.githubusercontent.com/32925631/93556707-f5654500-f9ab-11ea-807e-bf9ffeb84020.jpg" alt="1628f1a408fb77c3"></p><p><img src="https://user-images.githubusercontent.com/32925631/93556730-001fda00-f9ac-11ea-82f9-3b887041b400.jpg" alt="sdcsdcaascasc"></p><p>ç®€å•è¯´ä¸‹è¿‡ç¨‹ï¼š
æµè§ˆå™¨é€šè¿‡ç½‘ç»œå’Œå­˜å‚¨æ¨¡å—æ‹¿åˆ°HTMLæ–‡ä»¶ --&gt; ç„¶åé€šè¿‡HTMLè§£æå™¨è§£æhtmlæ–‡ä»¶ï¼Œå¦‚æœé‡åˆ°å¤–è”csså’Œjsæ–‡ä»¶æ—¶å°±å»åŠ è½½æ–‡ä»¶--&gt; ç„¶åHTMLè§£æå™¨å’Œcssè§£é‡Šå™¨åŒæ—¶è¿›è¡Œå·¥ä½œï¼Œç”Ÿæˆç›¸å¯¹åº”çš„DOMæ ‘å’Œæµè§ˆå™¨å¯ä»¥è§£æçš„CSSæ ‘å¹¶è¿›è¡Œæ ·å¼è®¡ç®—ï¼ˆstylesheetsï¼Œå¦‚ï¼šem-&gt;px, é¢œè‰²-&gt;rgb()ç­‰ï¼‰ --&gt; æœ€ååˆå¹¶ç”Ÿæˆæ¸²æŸ“æ ‘ï¼Œç»˜åˆ¶åˆ°æ˜¾ç¤ºå™¨ä¸Š</p><p>æ„å»ºDOMæ ‘å‰åï¼š
<img src="https://user-images.githubusercontent.com/32925631/93556756-0e6df600-f9ac-11ea-8a36-7bdfae34ead5.jpg" alt="0555517b92e9"></p><p>æ„å»ºCSSæ ‘å‰åï¼š
<img src="https://user-images.githubusercontent.com/32925631/93556775-17f75e00-f9ac-11ea-9c6e-d0a6616acb9c.jpg" alt="091656b"></p><p>æœ€åç”Ÿæˆçš„æ¸²æŸ“æ ‘ï¼š
<img src="https://user-images.githubusercontent.com/32925631/93556790-1ded3f00-f9ac-11ea-9182-fe14b2f03682.jpg" alt="92d707f25tplvk3"></p><blockquote><p>æ¸²æŸ“æ ‘ç”Ÿæˆæ—¶ï¼Œå› ä¸ºé¡µé¢ä¸­ä¼šæœ‰ä¸€äº›å¤æ‚çš„æ•ˆæœï¼Œæ¯”å¦‚è„±ç¦»æ–‡æ¡£æµï¼Œ3DåŠ¨ç”»ï¼ŒåŒ…æ‹¬è®¾ç½®z-indexç­‰ï¼Œä¸ºäº†æ›´åŠ æ–¹ä¾¿åœ°å®ç°è¿™äº›æ•ˆæœï¼Œæ¸²æŸ“å¼•æ“è¿˜éœ€è¦ä¸ºç‰¹å®šçš„èŠ‚ç‚¹ç”Ÿæˆä¸“ç”¨çš„å›¾å±‚ï¼Œå¹¶ç”Ÿæˆä¸€æ£µå¯¹åº”çš„å›¾å±‚æ ‘ï¼Œå°±åƒpsä¸­å›¾å±‚çš„æ¦‚å¿µä¸€æ ·ï¼Œé¡µé¢å¹¶ä¸æ˜¯ä¸€ä¸ªå¹³é¢è€Œæ˜¯ä¸€ä¸ª3Dçš„ç«‹ä½“ç»“æ„ï¼Œè¿™ä¸ªå¯ä»¥åœ¨æµè§ˆå™¨è°ƒè¯•ä¸­çœ‹åˆ°</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1pas" id="æ€§èƒ½é—®é¢˜"></a>æ€§èƒ½é—®é¢˜<a aria-hidden="true" tabindex="-1" class="hash-link" href="#æ€§èƒ½é—®é¢˜" title="Direct link to heading">#</a></h2><p>ç°åœ¨åœ¨å‰ç«¯çš„reactå’Œvueä¸¤å¤§æ¡†æ¶ä¸­ï¼Œéƒ½é‡‡ç”¨äº†virtualDomï¼Œç›®çš„æ˜¯ä¸ºäº†å°½å¯èƒ½çš„å‡å°‘domæ“ä½œï¼Œdomæ“ä½œæ˜¯æ˜‚è´µçš„ï¼Œå¾ˆæµªè´¹æ€§èƒ½çš„ï¼ˆvueçš„ä½œè€…æ›¾ç»è¯´è¿‡ï¼švirtualDomçš„å‡ºç°æœ€ä¸»è¦çš„æ˜¯è§£å†³äº†å¤šç«¯å…¬ç”¨ä¸€å¥—ä»£ç ï¼‰å› ä¸ºæ“ä½œdomå¿…ç„¶ä¼šå¼•èµ·é‡ç»˜æˆ–è€…é‡æ’ï¼Œé‡æ’å¿…å®šä¼šå¼•èµ·é‡ç»˜ã€‚æ‰€ä»¥å¼€å‘è€…åœ¨å¼€å‘çš„æ—¶å€™è¦é¿å…ç›´æ¥æ“ä½œDOMï¼Œç°åœ¨å¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¼šé€šè¿‡å¯¹é‡æ’è¿›è¡Œä¼˜åŒ–æé«˜æ€§èƒ½</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/browser">browser</a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/doc2/">Second Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/ximoThorn/ihooks" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://doranui.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">doranUI</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2022 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.434451da.js"></script>
<script src="/runtime~main.5370db81.js"></script>
<script src="/main.05977f1d.js"></script>
<script src="/1.88cb93a9.js"></script>
<script src="/2.611b72e2.js"></script>
<script src="/4.1459d7e9.js"></script>
<script src="/a6aa9e1f.7bc73ca9.js"></script>
<script src="/271584f9.65e5c66d.js"></script>
<script src="/f9cf05c7.c2228a74.js"></script>
<script src="/db4fee23.4dec3272.js"></script>
<script src="/053dc805.b0b3beee.js"></script>
<script src="/d1e50573.4f2d03d5.js"></script>
<script src="/fcf09424.13a26563.js"></script>
<script src="/b2b675dd.aa78c02e.js"></script>
</body>
</html>